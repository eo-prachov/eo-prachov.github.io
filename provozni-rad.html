<!DOCTYPE html>
<html lang="cs">
<head>
    <title>Provozní řád | Eko-Oáza Prachov</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Provozní a ubytovací řád.">
    <link rel="canonical" href="https://www.example.com/provozni-rad.html">
    <style>
        :root{--primary-blue:#007bff;--text-color:#333;--background-color:#fff;--container-bg:#2570b8}
        *, *:before, *:after { box-sizing: border-box; }
        body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background-color:var(--container-bg);color:var(--text-color);margin:0;padding:0;display:flex;justify-content:center;font-size:18px;line-height:1.6}
        
        .container{
            background-color:var(--background-color);
            width:100%;
            max-width:960px;
            margin:20px;
            padding:20px;
            box-shadow:0 0 15px rgba(0,0,0,.2); 
            display: flex;
            flex-direction: column;
        }

        header{padding:20px 0;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background-color:var(--background-color);z-index:100;border-bottom:1px solid #eee;box-shadow:0 2px 5px rgba(0,0,0,.05)}
        header h1{margin:0;font-size:28px}
        header h1 a{text-decoration:none;color:var(--text-color);cursor:pointer}
        nav a{margin-left:15px;text-decoration:none;color:var(--primary-blue);font-weight:700;cursor:pointer}
        nav a:hover{text-decoration:underline}
        
        .info-box{border:1px solid #ccc;padding:15px;margin-bottom:20px;background-color:#f9f9f9}
        .info-box p{margin:5px 0}
        .bold{font-weight:700}.text-center{text-align:center}.text-right{text-align:right}
        
        /* ZAROVNÁNÍ TEXTU PRO PROVOZNÍ ŘÁD */
        .rules-content { text-align: justify; }

        .editable-text { 
            width: 100%;
            overflow-wrap: anywhere;
            word-wrap: break-word; 
            word-break: break-word; 
            hyphens: auto;
            max-width: 100%;
        }

        #admin-toolbar{display:none;position:fixed;top:0;left:0;width:100%;background:#2c3e50;color:#fff;padding:10px;z-index:9999;box-shadow:0 2px 5px rgba(0,0,0,.3);text-align:center; flex-wrap: wrap; justify-content: center;}
        #admin-toolbar button{background:#3498db;color:#fff;border:none;padding:8px 15px;cursor:pointer;border-radius:3px;margin:5px;font-size:14px}
        #admin-toolbar button:hover{background:#2980b9}
        #admin-toolbar button#save-btn{background:#27ae60}
        #admin-toolbar button#save-btn:hover{background:#229954}
        #admin-toolbar button#logout-btn{background:#e74c3c}
        #admin-toolbar button#logout-btn:hover{background:#c0392b}

        .editable-text[contenteditable=true]{outline:2px dashed #3498db}
        #login-modal{display:none;position:fixed;z-index:10001;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.6)}
        #login-modal form{background-color:#fefefe;margin:15% auto;padding:20px;border:1px solid #888;width:80%;max-width:400px;text-align:center;border-radius:5px}
        #login-modal input{width:90%;padding:12px 20px;margin:8px 0;display:inline-block;border:1px solid #ccc;box-sizing:border-box}
        #login-modal button{background-color:#4caf50;color:#fff;padding:14px 20px;margin:8px 0;border:none;cursor:pointer;width:90%}
        
        @media screen and (max-width:768px){
            body{font-size:16px}
            .container{margin:0;padding:10px;box-shadow:none}
            header{flex-direction:column;align-items:flex-start;position:static;box-shadow:none;padding:15px 0}
            header h1{margin-bottom:10px;font-size:24px}
            nav{display:flex;justify-content:space-around;width:100%}
            nav a{margin:5px 0;font-size:14px}
        }
    </style>
</head>
<body>
    <div id="admin-toolbar">
        <span>Režim úprav</span>
        <button id="save-btn" onclick="saveAllChanges()">Uložit změny</button>
        <button onclick="addTextBox()">+ Přidat text</button>
        <button id="delete-mode-btn" onclick="toggleDeleteMode()">Smazat text</button>
        <button id="logout-btn" onclick="logout()">Odhlásit se</button>
    </div>
    <div id="login-modal">
        <form onsubmit="handleLogin(event)">
            <h2>Admin Login</h2>
            <input type="email" id="email" value="admin@e-o-p.cz" required>
            <input type="password" id="password" placeholder="Heslo" required>
            <button type="submit">Přihlásit se</button>
            <p style="font-size: 12px; color: #777;">Pro zavření stiskněte Esc</p>
        </form>
    </div>

    <div class="container">
        <header>
            <h1><a onclick="goHome()">Eko-Oáza Prachov</a></h1>
            <nav id="nav-cs">
                <a href="index.html">Úvod</a>
                <a href="zajimava-mista.html">Zajímavá místa</a>
                <a onclick="switchLanguage('en')">English version</a>
            </nav>
            <nav id="nav-en" style="display:none;">
                <a href="index.html?lang=en">Home</a>
                <a href="zajimava-mista.html?lang=en">Places of interest</a>
                <a onclick="switchLanguage('cs')">Česká verze</a>
            </nav>
        </header>

        <main id="main-content">
            <div id="lang-cs">
                 <div class="info-box editable-text" data-field="cs-rules-info-box"></div>
                 <div class="editable-text rules-content" data-field="cs-rules-content"></div>
            </div>
            <div id="lang-en" style="display:none;">
                <div class="info-box editable-text" data-field="en-rules-info-box"></div>
                <div class="editable-text rules-content" data-field="en-rules-content"></div>
            </div>
        </main>
        
        <footer id="footer-cs">
             Spolupráce: <a href="https://www.e-chalupy.cz/" target="_blank">e-chalupy.cz</a> <a href="https://www.levneubytovani.net/" target="_blank">LevneUbytovani.net</a> <a href="https://chalupy-ubytovani.cz/" target="_blank">chalupy-ubytovani.cz</a>
        </footer>
        <footer id="footer-en" style="display:none;">
            Cooperation with: <a href="https://www.e-chalupy.cz/" target="_blank">e-chalupy.cz</a> <a href="https://www.levneubytovani.net/" target="_blank">LevneUbytovani.net</a> <a href="https://chalupy-ubytovani.cz/" target="_blank">chalupy-ubytovani.cz</a>
        </footer>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <script id="main-script">
        const firebaseConfig = { apiKey: "AIzaSyCuI9hhPtQMDkNqlQmmPfJRMWZWZFrT3hw", authDomain: "eko-oaza-website.firebaseapp.com", projectId: "eko-oaza-website", storageBucket: "eko-oaza-website.firebasestorage.app", messagingSenderId: "32000760259", appId: "1:32000760259:web:b6b797ca91de9bd7688576", measurementId: "G-0KLWHCEM16" };
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let isAdmin = false, unsavedChanges = false, dbInterval = null;
        const loginModal = document.getElementById('login-modal');
        const seoData = { cs: { title: "Provozní řád | Eko-Oáza Prachov", description: "Provozní a ubytovací řád." }, en: { title: "Operating Rules | Eko-Oáza Prachov", description: "Operating and accommodation rules." } };

        const RESTORE_DATA = {
            'provozni-rad_cs': {
                'cs-rules-info-box': `<h3>Eko-Oáza Prachov</h3><p><b class="bold">Chatová osada v Českém ráji, Prachov 58, provozovatel:</b> Ing.Petr Hejna</p> <p><b class="bold">IČO:</b> 66314364</p> <p><b class="bold">Provozní doba:</b> červenec-srpen (jen po dohodě s klientem)</p> <p><b class="bold">č.ú.</b> 19-6866210217/0100</p> <p><b class="bold">tel.:</b> 606 930 170</p> <p><b class="bold">e-mail:</b> e-o-p@seznam.cz</p>`,
                'cs-rules-content': `<h3>Provozní řád</h3><p>Pobyt se řídí zásadami slušnosti a Ubytovacím řádem...</p>`
            },
            'provozni-rad_en': {
                'en-rules-info-box': `<h3>Eko-Oáza Prachov</h3><p><b class="bold">Cottage settlement in Bohemian Paradise, Prachov 58, operator:</b> Ing.Petr Hejna</p><p><b class="bold">IČO:</b> 66314364</p><p><b class="bold">Opening hours:</b> July-August (only by agreement)</p><p><b class="bold">Account No:</b> 19-6866210217/0100</p><p><b class="bold">Tel:</b> 606 930 170</p><p><b class="bold">E-mail:</b> e-o-p@seznam.cz</p>`,
                'en-rules-content': `<h3>Operating Rules</h3><p>The stay is governed by principles of decency and the Accommodation Rules...</p>`
            }
        };

        function getPageDocId(lang) { const path = window.location.pathname; const page = path.split("/").pop().replace(".html", "") || "index"; return `${page}_${lang}`; }
        function setLanguage(lang) { 
            document.documentElement.lang = lang; 
            document.getElementById('lang-cs').style.display = lang === 'cs' ? 'block' : 'none'; 
            document.getElementById('lang-en').style.display = lang === 'en' ? 'block' : 'none'; 
            document.getElementById('nav-cs').style.display = lang === 'cs' ? 'flex' : 'none'; 
            document.getElementById('nav-en').style.display = lang === 'en' ? 'flex' : 'none'; 
            fetchFromDB();
        }
        
        function goHome() {
            if(checkUnsavedChanges()) {
                const lang = document.documentElement.lang;
                window.location.href = `index.html?lang=${lang}`;
            }
        }

        function switchLanguage(lang) { if(checkUnsavedChanges()) { const currentPage = window.location.pathname.split('/').pop() || 'index.html'; window.location.href = `${currentPage}?lang=${lang}`; } }
        
        auth.onAuthStateChanged(user => { 
            isAdmin = !!user; 
            if (isAdmin) { 
                enableAdminMode(); 
                if(dbInterval) clearInterval(dbInterval);
            } 
            else { 
                disableAdminMode();
                fetchFromDB();
                if(!dbInterval) dbInterval = setInterval(() => { if(!isAdmin) fetchFromDB(); }, 10000);
            } 
        });

        async function fetchFromDB() {
            if (isAdmin) return;
            const lang = document.documentElement.lang;
            const docId = getPageDocId(lang);
            try {
                const doc = await db.collection('content').doc(docId).get();
                if (doc.exists) { renderData(doc.data()); }
            } catch (error) { console.error(error); }
        }

        function renderData(data) {
            Object.keys(data).forEach(fieldId => {
                let element = document.querySelector(`[data-field="${fieldId}"]`);
                if (element && data[fieldId]) { element.innerHTML = data[fieldId]; }
            });
        }

        function enableAdminMode() { 
            document.body.classList.add('admin-mode'); 
            document.getElementById('admin-toolbar').style.display = 'flex'; 
            document.querySelectorAll('.editable-text').forEach(el => { 
                el.contentEditable = true; 
                el.addEventListener('input', () => { unsavedChanges = true; });
            }); 
        }

        function disableAdminMode() { 
            document.body.classList.remove('admin-mode'); 
            document.getElementById('admin-toolbar').style.display = 'none'; 
            document.querySelectorAll('.editable-text').forEach(el => { el.contentEditable = false; }); 
        }

        async function saveAllChanges() {
            const promises = [];
            document.querySelectorAll('.editable-text').forEach(element => {
                const fieldId = element.dataset.field;
                if (!fieldId) return;
                const lang = fieldId.startsWith('cs-') ? 'cs' : 'en';
                promises.push(db.collection('content').doc(getPageDocId(lang)).set({ [fieldId]: element.innerHTML }, { merge: true }));
            });
            await Promise.all(promises);
            unsavedChanges = false;
            alert('Uloženo!');
        }

        async function handleLogin(event) { event.preventDefault(); try { await auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('password').value); loginModal.style.display = 'none'; } catch (e) { alert(e.message); } }
        async function logout() { if(checkUnsavedChanges()) { await auth.signOut(); location.reload(); } }
        function checkUnsavedChanges() { if (unsavedChanges) return confirm("Máte neuložené změny!"); return true; }
        document.addEventListener('keydown', (e) => { if (e.ctrlKey && e.key === 'l') { e.preventDefault(); loginModal.style.display = 'block'; } });
        document.addEventListener('DOMContentLoaded', () => { const params = new URLSearchParams(window.location.search); setLanguage(params.get('lang') || 'cs'); });
    </script>
</body>
</html>